import datetime
import sqlite3
from aiogram.utils.emoji import emojize
from IMP.BASIS_imp import to_right_russian_word_day, big_replacing
from IMP.CONSTS_imp import dict_with_circle

# –±–¥
conn = sqlite3.connect(f'TWO_DB.db', check_same_thread=False)
cursor = conn.cursor()


def getting_profile_user(login_user, tg_username):

    # –æ–±—Ä–∞—â–µ–Ω–∏–µ
    cursor.execute('SELECT Appeal FROM All_Users WHERE Login=?', (login_user,))
    appeal_user = cursor.fetchone()[0]
    if appeal_user is None:
        appeal_user = f'@{tg_username}'

    # –∞–π–¥–∏ –≤ –±–æ—Ç–µ
    cursor.execute('SELECT Bot_ID FROM All_Users WHERE Login=?', (login_user,))
    botID_user = cursor.fetchone()[0]

    # –¥–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    cursor.execute('SELECT Date_Reg FROM All_Users WHERE Login=?', (login_user,))
    date_reg_user = cursor.fetchone()[0]

    # –¥–µ–ª—å—Ç–∞ –¥–∞—Ç
    date_reg_datetime = datetime.datetime.strptime(date_reg_user, '%Y-%m-%d %H:%M:%S.%f')
    delta_days_user = (datetime.datetime.now() - date_reg_datetime).days
    delta_in_emoji = big_replacing(delta_days_user, your_dict=dict_with_circle)

    return '*–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å –≤* @RzemsBot*:*' \
           '\n ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ\n' \
           f'üîä*–í—ã –º–æ–π -* ___{appeal_user}___\n' \
           f'üë§*–í–∞—à –ª–æ–≥–∏–Ω:* #{login_user}\n' \
           f'üîë*–í–∞—à ID –≤ DAY PLAN:* `{botID_user}`' \
           f'\n‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ\n' \
           f'‚ô•Ô∏è*–í—ã —Å –Ω–∞–º–∏ —É–∂–µ: {delta_in_emoji} {to_right_russian_word_day(delta_days_user)}*‚ô•Ô∏è'
